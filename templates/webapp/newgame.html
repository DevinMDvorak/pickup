{% extends 'base.html' %}

{% block title %}{% endblock %}

{% block body_block %}
        <h1>Create a new game.</h1>

        <style>
            #map {
                width: 90%;
                height: 600px;
                margin: auto;
                background-color: #CCC;
            }
        </style>

        <div id="map"></div>

        <p id="demo"></p>

        <script>
            var marker;
            
            function initMap() {
                var mapDiv = document.getElementById('map');
                var map = new google.maps.Map(mapDiv, {
                center: {lat: 36.0764, lng: -94.1608},
                zoom: 13,
                streetViewControl: false
                });
                /*var infoWindow = new google.maps.InfoWindow({map: map});*/
                
                
                // Try HTML5 geolocation.
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        /*infoWindow.setPosition(pos);
                        infoWindow.setContent('Current location.');*/
                        marker = new google.maps.Marker({
                            map: map,
                            draggable: true,
                            animation: google.maps.Animation.DROP,
                        });
                        marker.setPosition(pos);
                        map.setCenter(pos);
                    }, function() {
                        handleLocationError(true, infoWindow, map.getCenter());
                    });
                } else {
                    // Browser doesn't support Geolocation
                    handleLocationError(false, infoWindow, map.getCenter());
                    }
            }

            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            }
                
            
            google.maps.event.addListener(marker, 'dragend', function (evt) {
                document.getElementById('isitworking').innerHTML = '<p>Marker dropped: Current Lat: ' + evt.latLng.lat().toFixed(3) + ' Current Lng: ' + evt.latLng.lng().toFixed(3) + '</p>';
            });

            google.maps.event.addListener(marker, 'dragstart', function (evt) {
                document.getElementById('isitworking').innerHTML = '<p>Currently dragging marker...</p>';
            });
            
            
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?callback=initMap"
        async defer></script>


        <form id="newgame_form" method="post" action="/webapp/newgame/"
                enctype="multipart/form-data">

            {% csrf_token %}

            <!-- Display each form. The as_p method wraps each element in a paragraph
                 (<p>) element. This ensures each element appears on a new line,
                 making everything look neater. -->
            {{ form.as_p }}

            <!-- Provide a button to click to submit the form. -->
            <input type="submit" name="submit" value="Create" />
        </form>


        <div id="isitworking">Nothing yet...</div>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        <p>blakjlfkjd;ljkds;jf</p>
        

{% endblock %}
